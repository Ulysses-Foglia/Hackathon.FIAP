DROP TABLE IF EXISTS PESSOAS_TAREFAS
DROP TABLE IF EXISTS USUARIOS_TAREFAS
DROP TABLE IF EXISTS PESSOAS
DROP TABLE IF EXISTS TAREFAS
DROP TABLE IF EXISTS USUARIOS
DROP TABLE IF EXISTS AGENDA_MEDICO_DIA
DROP TABLE IF EXISTS AGENDA_MEDICO_MES 

CREATE TABLE  AGENDA_MEDICO_MES (
	ID INT NOT NULL IDENTITY CONSTRAINT PK_AGENDA_MEDICO_MES_ID PRIMARY KEY,
	MEDICOID INT NOT NULL,
	MESANO VARCHAR(6) NOT NULL,
	DIA INT NOT NULL,
	DIADISPONIVEL VARCHAR(15) NOT NULL,
	DATA_CRIACAO DATETIME NOT NULL,
);
GO

CREATE TABLE AGENDA_MEDICO_DIA (
	ID INT NOT NULL IDENTITY CONSTRAINT PK_AGENDA_MEDICO_DIA_ID PRIMARY KEY,
	HORARIO VARCHAR(5) NOT NULL,
	HORARIODISPONIVEL VARCHAR(15) NOT NULL,
	DATA_CRIACAO DATETIME NOT NULL,
	PACIENTEID INT NULL,
	AGENDAMEDICOID INT NOT NULL CONSTRAINT FK_AGENDA_M_DIA_AGENDA_MEDIC_MES FOREIGN KEY REFERENCES AGENDA_MEDICO_MES (ID)
);

CREATE TABLE USUARIOS (
	ID INT NOT NULL IDENTITY CONSTRAINT PK_USUARIOS_ID PRIMARY KEY,
	DATA_CRIACAO DATETIME NOT NULL,
	NOME VARCHAR(100) NOT NULL,
	CRM VARCHAR(10) NULL,
	EMAIL VARCHAR(100) NOT NULL,
	SENHA VARCHAR(20) NOT NULL,
	PAPEL VARCHAR(20) NOT NULL
);

INSERT INTO USUARIOS VALUES (GETDATE(), 'UsuTeste1', NULL, 'usuTeste1@email.com.br', 'MTIzNDU2', 'Admin')
INSERT INTO USUARIOS VALUES (GETDATE(), 'UsuTeste2', NULL, 'usuTeste2@email.com.br', 'MTIzNDU2', 'Comum')
INSERT INTO USUARIOS VALUES (GETDATE(), 'UsuTeste3', NULL, 'usuTeste3@email.com.br', 'MTIzNDU2', 'Comum')

SELECT*FROM USUARIOS WITH (NOLOCK)

SELECT 
AM.MEDICOID AS MEDICOID,
AMD.DIA AS DIAAGENDA,
AMD.DIADISPONIVEL AS DISPONIBILIDADEDODIA,
AMH.DATAEHHORA AS HORARIODODIA,
AMH.DISPONIVEL AS DISPONIBILIDADE
FROM AGENDA_MEDICO AM
LEFT JOIN AGENDA_MEDICO_DIA AMD ON AMD.AGENDAMEDICOID = AM.ID
LEFT JOIN AGENDA_MEDICO_HORARIO AMH ON AMH.AGENDAMEDICODIAID = AMD.ID
